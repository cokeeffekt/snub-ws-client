var SnubWsClient=function(){"use strict";const e=new Blob(['const worker=function(){const e=[];let n=null,o=()=>{},s={};const t="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,r="undefined"!=typeof SharedWorkerGlobalScope&&self instanceof SharedWorkerGlobalScope;return r?self.onconnect=function(n){const o=n.ports[0];e.push(o),o.onmessage=a,o.start(),c(["_internal:connected"])}:t&&(self.onmessage=a,c(["_internal:connected"])),{postToMain:e=>o=e,handleIncomingMessage:a,ready(){c(["_internal:connected"])}};function c(n){n=JSON.stringify(n),r?e.forEach((e=>e.postMessage(n))):t?self.postMessage(n):o({data:n})}function a(e){const[o,t]=JSON.parse(e.data);"_config"===o&&(s={...s,...t}),"_connect"===o&&async function(e){n&&(n.close(),await new Promise((e=>{n.onclose=()=>{e()}})));n=new WebSocket(s.url),n.onopen=()=>{n.send(JSON.stringify(["_auth",e]))},n.onmessage=e=>{const[n,o]=JSON.parse(e.data);return c("_acceptAuth"===n?["_internal:socket-connect",o]:[n,o])},n.onclose=e=>{c(["_internal:socket-disconnected",e]),n=null},n.onerror=e=>{console.error("Snub-Ws-Socket => Socket error:",e)}}(t),"_send"===o&&n&&n.send(JSON.stringify(t))}}("undefined"!=typeof self&&self);export default{postMessage:worker.handleIncomingMessage,postToMain:worker.postToMain,ready:worker.ready};'],{type:"application/javascript"});var n=URL.createObjectURL(e);const t={workerType:"SHARED_WORKER",workerName:"Snub-Ws-Client-Worker",url:"ws://localhost:8080",replyTimeout:1e4};class o{constructor(e,n){this.worker=new SharedWorker(e,n),this.port=this.worker.port,this.port.start(),this.port.onmessage=e=>{"function"==typeof this.onmessage&&this.onmessage(e)},this.port.onerror=e=>{"function"==typeof this.onerror&&this.onerror(e)}}postMessage(e){this.port.postMessage(e)}terminate(){this.port.close()}}return class{#e=null;#n=null;#t=t;#o="init";#s=null;#r=new Map;#i=()=>{};#a=()=>{};#c=()=>{};constructor(e){var n;this.#t={...t,...e},this.#n=this.#l(),(n=this.#n)._postMessage=n.postMessage,n.postMessage=function(e){n._postMessage(JSON.stringify(e))},this.#n.onmessage=e=>{const[n,t]=JSON.parse(e.data);if("_internal:connected"===n&&(this.#n.postMessage(["_config",{url:this.#t.url}]),this.#o="READY",this.connect(this.#s),this.#s=null),"_internal:socket-disconnected"===n&&this.#c(t),"_internal:socket-connect"===n&&this.#a(t),!n.startsWith("_internal:"))if(n.startsWith("_r:")){const[e,o,s]=this.#r.get(n);e&&(e(t),this.#r.delete(n),clearTimeout(s))}else this.#i(n,t)}}send(e,n){this.#n.postMessage(["_send",[e,n]])}fetch(e,n){return new Promise(((t,o)=>{const s="_r:"+function(){let e=46656*Math.random()|0,n=46656*Math.random()|0;return e=("000"+e.toString(36)).slice(-3),n=("000"+n.toString(36)).slice(-3),e+n}(),r=setTimeout((()=>{o(new Error("Timeout")),this.#r.delete(s)}),this.#t.replyTimeout);this.#r.set(s,[t,o,r]),this.#n.postMessage(["_send",[e,n,s]])}))}connect(e){"READY"===this.#o?this.#n.postMessage(["_connect",e]):this.#s=e}onopen(e){this.#a=e}onmessage(e){this.#i=e}onclose(e){this.#c=e}#l(){if("undefined"!=typeof SharedWorker&&!["WEB_WORKER","MAIN_THREAD"].includes(this.#t.workerType))try{const e=new o(n,{type:"module",name:this.#t.workerName});return this.#e="sharedWorker",e}catch(e){}if("undefined"!=typeof Worker&&!["MAIN_THREAD"].includes(this.#t.workerType))try{const e=new Worker(n,{type:"module",name:this.#t.workerName});return this.#e="webWorker",e}catch(e){}this.#e="mainThread";const e={postMessage:function(e){},onmessage:function(e){}};return import(n).then((n=>{e.postMessage=e=>{n.default.postMessage({data:JSON.stringify(e)})},e.postToMain=n.default.postToMain((n=>{e.onmessage(n)})),n.default.ready()})).catch((e=>{console.error("Failed to load worker script:",e)})),e}}}();
//# sourceMappingURL=snub-ws-client.min.js.map
